# see https://github.com/elasticsearch/kibana/blob/master/sample/nginx.conf
daemon off;
error_log <%= Dir.getwd %>/var/log/nginx-access.log;
pid <%= Dir.getwd %>/var/run/nginx.pid;

events {
    worker_connections 4096;
}

http {
    include /etc/nginx/mime.types;

    access_log <%= Dir.getwd %>/var/log/nginx-access.log;

    client_body_temp_path <%= Dir.getwd %>/var/tmp/nginx-client-body-temp;

    # unused
    fastcgi_cache_path /dev/null keys_zone=none:1m;

    proxy_read_timeout 90;
    proxy_temp_path <%= Dir.getwd %>/var/tmp/nginx-proxy-temp;

    server {
        listen *:8080;
        server_name kibana.vagrant;

        location ~ ^/_aliases$ {
            proxy_pass http://127.0.0.1:9200;
        }

        location ~ ^/.*/_search$ {
            proxy_pass http://127.0.0.1:9200;
        }

        location / {
            root <%= Dir.getwd %>/app/kibana;
            index index.html;
        }
    }
}
